function getUpsModule(){if("win32"==process.platform){if("x64"==process.arch)return require("./lib/win64/ipsae.node");if("ia32"==process.arch)return require("./ib/win32/ipsae.node")}else if("linux"==process.platform){if("x64"==process.arch)return require("./lib/linux64/ipsae.node");if("ia32"==process.arch)return require("./lib/linux32/ipsae.node")}return console.error("can't UPS module!"),null}module.exports=function(e){"use strict";e.nodes.registerType("atipsae",function(a){function l(e){var a={serial:s.serial,payload:e};s.send([a,null,null])}function r(e){try{var a={serial:s.serial,payload:JSON.parse(e)};s.send([null,a,null])}catch(a){s.error(a.message,e)}}e.nodes.createNode(this,a);var t=getUpsModule();this.serial=a.serial;var s=this;""!==s.serial&&null!=t&&t.start(s.serial,l,r),null!=t&&(t.getSerialStatus()?s.status({fill:"green",shape:"dot",text:"Comport:Avaliable"}):s.status({fill:"red",shape:"ring",text:"Comport:Not avaliable"})),this.on("input",e=>{var a="",i={};null!=t?e.payload.port?(t.bye(),s.serial=e.payload.port,t.start(e.payload.port,l,r),t.getSerialStatus()?s.status({fill:"green",shape:"dot",text:"Comport: Avaliable"}):s.status({fill:"red",shape:"ring",text:"Comport: Not avaliable"})):(e.payload.UPSDCinLostDelayTime?a=t.setDCinLostDelayTime(parseInt(e.payload.UPSDCinLostDelayTime,10)):e.payload.UPSDCoutCutOffDelayTime&&(a=t.setDCoutCutOffDelayTime(parseInt(e.payload.UPSDCoutCutOffDelayTime,10))),""===a&&(a="error"),i.payload="UPS: "+a,s.send([null,null,i])):(i.payload="UPS: load module error",s.send([null,null,i]))}),this.on("close",()=>{null!=t&&t.bye()})})};
